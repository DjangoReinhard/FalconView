<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FalconView: Help System for small projects</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FalconView
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">UI to control machines drived by linuxCNC</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_oldStuff_help_de.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Help System for small projects </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In letzter Zeit habe ich mit dem Hilfesystem gekämpft. Leider hat das Hilfesystem von Qt nicht so funktioniert, wie erwartet. Vielleicht war ich auch nicht schlau genug, es anzuwenden ... Wie auch immer - ich wollte QHelpEngine erweitern, musste dann aber feststellen, dass die wichtigsten Funktionen nicht virtuell sind - also keine Chance auf Anpassung.</p>
<p>Da mir auch nicht gefiel, dass das Hilfesystem von Qt keine Bilder unterstützt, habe ich mich entschlossen, selbst Hand anzulegen. Ich habe mit qdoc-Format angefangen, musste dann aber hören, dass qdoc ein internes Werkzeug wäre. Mir wurde doxygen empfohlen. Nur wollte ich nicht meinen Quellcode dokumentieren, sondern ein Hilfesystem für Endanwender erzeugen.</p>
<p>Dafür ist doxygen nicht das richtige Werkzeug. Viel zu komplex und macht vieles, was ich nicht will. Bin nicht mal sicher, dass es auch das kann, was ich will ...</p>
<p>Ich wollte ein einfaches Werkzeug, welches nicht viel Zeitaufwand neben dem eigentlichen Schreiben erfordert. Ascidoc war im Gespräch, aber der Quellcode sieht nicht gerade lesbar aus. Bin dann bei markdown gelandet. Einige Befehle waren mir bereits von Foren bekannt, der Rest war schnell erforscht. Das schöne an markdown ist, dass der Quelltext nach wie vor lesbar bleibt.</p>
<p>Also habe ich umgestellt auf markdown. Recht bald merkte ich, dass das Original nicht ganz meinen Wünschen entsprach. Glücklicherweise gibt es die GitHub-Erweiterung. Damit konnte ich loslegen.</p>
<p>Meine Vorstellung war die, dass alle Dateien, die im Hilfesystem notwendig werden in der Hilfsdatei enthalten sein sollten. So suchte ich nach Unterstützung für Archive für Qt. Leider bietet Qt nichts offiziell an. Auch die Wünsche der Anwender nach derartiger Unterstützung wurden seit Jahren ignoriert. Das stimmt besonders traurig, wenn man herausfindet, dass es den Code bereits seit Jahren in Qt gibt. Nur eben als intern gekennzeichnet :(</p>
<p>Ich habe es trotzdem versucht und bin begeistert.</p>
<p>meine Verzeichnisstruktur sieht folgendermaßen aus: </p><div class="fragment"><div class="line">docs</div>
<div class="line">+---src</div>
<div class="line">|   +---images</div>
<div class="line">+---html</div>
</div><!-- fragment --><p> Im Verzeichnis <b>docs</b> liegt die <em>qhp</em>-Datei, sowie Hilfsdateien für die Erzeugung der Hilfedatei.</p>
<p>Im Verzeichnis src liegen die markdown-Dateien. Da mein Projekt nicht so groß ist, liegen dort die lokalisierten und die Original-Dateien. Der Einfachheit halber habe ich in meiner Sprache geschrieben und erst später die englische Version erstellt. Wie sich herausstellen sollte, war das der richtige Weg.</p>
<p>Beim Forschen zu markdown bin ich über einen Hinweis zu einem Editor gestolpert, der eine Live-Vorschau für markdown anbietet, ohne dass man großartig was installieren muss. Der Editor nennt sich <b>Atom</b> und ist meiner Ansicht nach <b>unverzichtbar</b> :) Er kann leider keinen Überschreibmodus - was recht gewöhnungsbedürftig ist. Trotzdem war es ein reines Vergnügen, damit die Hilfetexte zu schreiben.</p>
<p><img src="src/images/Atom03.jpg" alt="Atom" class="inline"/></p>
<p>Warum war es richtig, in meiner Sprache mit dem Schreiben anzufangen? Wie sich herausstellte, kann weder qdoc noch markdown mit den deutschen Sonderzeichen umgehen. Es half auch nicht, die HTML-Datei als utf-8 zu deklarieren.</p>
<p>Also schrieb ich einen Filter, der die HTML-Ausgabe von markdown bearbeitet. Später stellte sich heraus, dass Atom bei jedem Zeilenumbruch ein &lt;br&gt; erzeugt, was sehr unschön aussieht. Also erweiterte ich den Filter, damit dieser alle &lt;br&gt; entfernt.</p>
<p>Hier ein Vorgeschmack, wie die Online-Hilfe jetzt aussieht: <img src="src/images/FVHlp01.jpg" alt="Help" class="inline"/></p>
<p>Ein weiterer Grund, warum es von Vorteil war, in meiner Sprache anzufangen: deepl versteht markdown. Deshalb konnte ich per copy/paste alle Dateien übersetzen und hatte so bereits ca. 70% übersetzt. Die Nacharbeit ging dank Atom leicht von der Hand.</p>
<p>Kommen wir zum Quellcode. Ich habe mich bei der Schnittstelle an QHelpEngine orientiert und analog dazu erzeugt auch meine <a class="el" href="classHelpEngine.html">HelpEngine</a> das Widget mit dem Baum der Seiten und eines für die Liste der Fachbegriffe.</p>
<p>Als Rahmen habe ich ein QDockable gewählt, welches links die beiden Widgets der <a class="el" href="classHelpEngine.html">HelpEngine</a> in einem Notebook darstellt und rechts davon eine Erweiterung des QTextBrowser. Erweiterung deshalb, weil die Funktion <b>loadResource</b> erweitert werden muss, um auch Links und Bilder aus der Hilfedatei laden zu können.</p>
<p>Die qhp-Datei, wie sie von Qt verwendet wird hat mir gefallen. Enthält sie doch bereits (fast) alles Notwendige. Da ich Mehrsprachigkeit unterstützten wollte, musste ich die Datei geringfügig abändern. Hier meine Beschreibungsdatei:</p>
<div class="fragment"><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</div>
<div class="line">&lt;QtHelpProject version=&quot;1.0&quot;&gt;</div>
<div class="line">    &lt;namespace&gt;de.schwarzrot.falconview.0.1&lt;/namespace&gt;</div>
<div class="line">    &lt;virtualFolder&gt;FalconView&lt;/virtualFolder&gt;</div>
<div class="line">    &lt;filterSection&gt;</div>
<div class="line">        &lt;filterAttribute&gt;FalconView&lt;/filterAttribute&gt;</div>
<div class="line">        &lt;filterAttribute&gt;0.1&lt;/filterAttribute&gt;</div>
<div class="line">        &lt;toc&gt;</div>
<div class="line">            &lt;section title=&quot;User Guide&quot; ref=&quot;index&quot;&gt;</div>
<div class="line">                &lt;section title=&quot;linuxCNC&quot; ref=&quot;integration&quot;/&gt;</div>
<div class="line">                &lt;section title=&quot;Center-Area&quot; ref=&quot;reference&quot;&gt;</div>
<div class="line">                    &lt;section title=&quot;NC-Editor&quot; ref=&quot;nceditor&quot;/&gt;</div>
<div class="line">                    &lt;section title=&quot;3D-Preview&quot; ref=&quot;preview&quot;/&gt;</div>
<div class="line">                    &lt;section title=&quot;JogView&quot; ref=&quot;jogview&quot;/&gt;</div>
<div class="line">                    &lt;section title=&quot;Settings&quot; ref=&quot;settingsnotebook&quot;&gt;</div>
<div class="line">                        &lt;section title=&quot;Fixtures&quot; ref=&quot;fixturemanager&quot;/&gt;</div>
<div class="line">                        &lt;section title=&quot;Preferences&quot; ref=&quot;preferences&quot;/&gt;</div>
<div class="line">                        &lt;section title=&quot;LC-Tools&quot; ref=&quot;lctooltable&quot;/&gt;</div>
<div class="line">                    &lt;/section&gt;</div>
<div class="line">                &lt;/section&gt;</div>
<div class="line">                &lt;section title=&quot;Toolbars&quot; ref=&quot;toolbars&quot;&gt;</div>
<div class="line">                    &lt;section title=&quot;ApplicationMode&quot; ref=&quot;tbappmode&quot;/&gt;</div>
<div class="line">                    &lt;section title=&quot;RunMode&quot; ref=&quot;tbrunmode&quot;/&gt;</div>
<div class="line">                    &lt;section title=&quot;Machine&quot; ref=&quot;tbmachine&quot;/&gt;</div>
<div class="line">                    &lt;section title=&quot;Extended&quot; ref=&quot;tbextend&quot;/&gt;</div>
<div class="line">                &lt;/section&gt;</div>
<div class="line">                &lt;section title=&quot;Status-Info&quot; ref=&quot;info&quot;&gt;</div>
<div class="line">                    &lt;section title=&quot;Position&quot; ref=&quot;sipos&quot;/&gt;</div>
<div class="line">                    &lt;section title=&quot;ToolInfo&quot; ref=&quot;sitool&quot;/&gt;</div>
<div class="line">                    &lt;section title=&quot;act.Codes&quot; ref=&quot;sicodes&quot;/&gt;</div>
<div class="line">                    &lt;section title=&quot;SpeedInfo&quot; ref=&quot;sispeed&quot;/&gt;</div>
<div class="line">                &lt;/section&gt;</div>
<div class="line">                &lt;section title=&quot;use case&quot; ref=&quot;usage&quot;/&gt;</div>
<div class="line">            &lt;/section&gt;</div>
<div class="line">        &lt;/toc&gt;</div>
<div class="line">        &lt;keywords&gt;</div>
<div class="line">            &lt;keyword name=&quot;3D Preview&quot; id=&quot;3D Preview&quot; ref=&quot;preview&quot;/&gt;</div>
<div class="line">            &lt;keyword name=&quot;FileManager&quot; id=&quot;fileManager&quot; ref=&quot;filemanager&quot;/&gt;</div>
<div class="line">            &lt;keyword name=&quot;FixtureManager&quot; id=&quot;FixtureManager&quot; ref=&quot;fixturemanager&quot;/&gt;</div>
<div class="line">            &lt;keyword name=&quot;JogView&quot; id=&quot;JogView&quot; ref=&quot;jogview&quot;/&gt;</div>
<div class="line">            &lt;keyword name=&quot;LCToolTable&quot; id=&quot;LCToolTable&quot; ref=&quot;lctooltable&quot;/&gt;</div>
<div class="line">            &lt;keyword name=&quot;MDIEditor&quot; id=&quot;MDIEditor&quot; ref=&quot;mdiedit&quot;/&gt;</div>
<div class="line">            &lt;keyword name=&quot;PathEditor&quot; id=&quot;PathEditor&quot; ref=&quot;nceditor&quot;/&gt;</div>
<div class="line">            &lt;keyword name=&quot;PreferencesEditor&quot; id=&quot;PreferencesEditor&quot; ref=&quot;preferences&quot;/&gt;</div>
<div class="line">            &lt;keyword name=&quot;SettingsNotebook&quot; id=&quot;SettingsNotebook&quot; ref=&quot;settingsnotebook&quot;/&gt;</div>
<div class="line">            &lt;keyword name=&quot;TestEdit&quot; id=&quot;TestEdit&quot; ref=&quot;nceditor&quot;/&gt;</div>
<div class="line">            &lt;keyword name=&quot;ToolEditor&quot; id=&quot;ToolEditor&quot; ref=&quot;tooleditor&quot;/&gt;</div>
<div class="line">            &lt;keyword name=&quot;ToolManager&quot; id=&quot;ToolManager&quot; ref=&quot;toolmanager&quot;/&gt;</div>
<div class="line">        &lt;/keywords&gt;</div>
<div class="line">        &lt;files&gt;</div>
<div class="line">            &lt;file&gt;*.html&lt;/file&gt;</div>
<div class="line">        &lt;/files&gt;</div>
<div class="line">    &lt;/filterSection&gt;</div>
<div class="line">&lt;/QtHelpProject&gt;</div>
</div><!-- fragment --><p>Namespace, virtualFolder und filterSection habe ich unverändert übernommen, auch wenn ich keines davon benutze. Wichtig sind mir nur die Bereiche <b>&lt;toc&gt;</b> und <b>&lt;keywords&gt;</b>. Wie man sehen kann, habe ich die Dateiendung bei den <b>ref</b>-Attributen entfernt. Auf diese Weise kann ich Mehrsprachigkeit unterstützen, ohne dass die Anwendung unterschiedliche Hilfedateien laden/kennen muss.</p>
<p>Die Anwendung ist einfach. In <em><a class="el" href="classMainWindow.html">MainWindow</a></em> wird das Hilfewidget erzeugt: </p><div class="fragment"><div class="line">dlgHelp = new HelpDialog(this);</div>
</div><!-- fragment --><p> Im Formular für das <a class="el" href="classMainWindow.html">MainWindow</a> wird ein Menueintrag für die Hilfe erstellt, sodass in der Anwendung nur noch die Hilfefunktion mit dem Menüeintrag verbunden werden muss:</p>
<div class="fragment"><div class="line">ui-&gt;actionHelp-&gt;setShortcut(QKeySequence::HelpContents);</div>
<div class="line">connect(ui-&gt;actionHelp, &amp;QAction::triggered, dlgHelp, &amp;HelpDialog::showHelp);</div>
</div><!-- fragment --><p> Im meiner Anwendung will ich bei jedem Seitenwechsel die passende Hilfe anzeigen. Dazu habe ich die <em>objectName</em> der Seiten als Fachbegriff erfasst und übersetzt (händische Erweiterung der *.ts Datei). Ferner sind die Fachbegriffe in obiger *.qhp Datei enthalten. In der Anwendung rufe ich die Hilfe dann wie folgt auf: </p><div class="fragment"><div class="line">void DynCenterWidget::showEvent(QShowEvent* e) {</div>
<div class="line">  QWidget::showEvent(e);</div>
<div class="line">  if (e-&gt;type() == QEvent::Show) Core().help4Keyword(objectName());</div>
<div class="line">  }</div>
</div><!-- fragment --><p> Wie bereits erwähnt muss <b>loadResource</b> von QTextBrowser geändert werden. Leider stellte sich heraus, dass QTextBrowser keine CSS-Styles verarbeitet, die im Meta-Bereich der Seite hinterlegt sind. Nach einigen misslungenen Versuchen habe ich die Variante gewählt, wo im browser ein DefaultStyleSheet geladen wird. Das führte zum gewünschten Erfolg: </p><div class="fragment"><div class="line">HelpBrowser::HelpBrowser(QWidget* parent)</div>
<div class="line"> : QTextBrowser(parent)</div>
<div class="line"> , engine(nullptr) {</div>
<div class="line">  document()-&gt;setDefaultStyleSheet(defaultStyles);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">const QString HelpBrowser::defaultStyles(&quot;table, th, td {&quot;</div>
<div class="line">                                           &quot;border-width: 1px;&quot;</div>
<div class="line">                                           &quot;border-color: #CCCCCC;&quot;</div>
<div class="line">                                           &quot;border-collapse: collapse;&quot;</div>
<div class="line">                                         &quot;}&quot;</div>
<div class="line">                                         &quot;img {vertical-align: middle; }&quot;</div>
<div class="line">                                         &quot;th, td {&quot;</div>
<div class="line">                                           &quot;padding: 15px;&quot;</div>
<div class="line">                                         &quot;}&quot;);</div>
</div><!-- fragment --><p> Bei den internen Hilfeklassen habe ich die Aufgaben verteilt. <b><a class="el" href="classHelpEngine.html">HelpEngine</a></b> kapselt den Zugriff aufs Archiv, während die Widgetklassen die *.qhp-Datei verarbeiten. Das Ergebnis der Verarbeitung wird einmal im Baum, bzw. der Liste abgelegt, zum anderen wird ein Verzeichnis erstellt, welches an die <b><a class="el" href="classHelpEngine.html">HelpEngine</a></b> übermittelt wird, sodass diese Anfragen nach Fachbegriffen bzw. Seiten beantworten und lokalisiert verarbeiten kann.</p>
<p>Deklaration: <a href="https://github.com/DjangoReinhard/FalconView/blob/main/src/util/helpengine.h">HelpEngine</a></p>
<p>Definition: <a href="https://github.com/DjangoReinhard/FalconView/blob/main/src/util/helpengine.cpp">HelpEngine</a></p>
<p>Die Hilfedateien sind wie folgt aufgebaut:</p><ul>
<li>preview.md - english version</li>
<li>preview*_de*.md - localized version</li>
</ul>
<p><b><a class="el" href="classHelpEngine.html">HelpEngine</a></b> versucht zuerst die lokalisierte Variante zu laden. Wenn das fehlschlägt (z.B. weil Locale <em>es</em> anstatt <em>de</em> verwendet wird), dann wird der englische Standard geladen.</p>
<p>Ein weiteres Problem (für mich) war, dass ich bei den Seiten viele Versuche mit unterschiedlichen Symbolen und Bildern machte, aber nicht alle in der Hilfedatei haben wollte. Ich musste also herausfinden, welche Bilder tatsächlich in den Hilfedateien verwendet werden. Insgesamt etwas zu viel, sich die Anwendung zu merken und jedes Mal einzugeben. Deshalb habe ich mir ein Script erstellt: </p><div class="fragment"><div class="line">#!/bin/bash</div>
<div class="line">project=FalconView</div>
<div class="line">extIN=md</div>
<div class="line">extOut=html</div>
<div class="line"> </div>
<div class="line">for i in $(ls src/*.$extIN)</div>
<div class="line">do</div>
<div class="line">  t=html${i#src}</div>
<div class="line">  d=${t%.$extIN}.$extOut</div>
<div class="line">  cat $i | gfm | fixhtml -e htmlEntities.def &gt; $d</div>
<div class="line">done</div>
<div class="line">cd src</div>
<div class="line">images=`grep -Ro -P &quot;\&zwj;(images/(.*)\&zwj;)&quot; | sed &#39;s%.*(images/%%&#39; | sed &#39;s%)%%&#39;`</div>
<div class="line">cd ..</div>
<div class="line">cp ${project}.qhp html</div>
<div class="line">mkdir html/images 2&gt;/dev/null</div>
<div class="line">for i in $images</div>
<div class="line">do</div>
<div class="line">  echo $i</div>
<div class="line">  cp src/images/$i html/images</div>
<div class="line">done</div>
<div class="line">cd html</div>
<div class="line">zip -u9 ../FalconView.qzh *.html images/* FalconView.qhp</div>
<div class="line">cp -a ../FalconView.qzh .</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
