<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>FalconView: Help System for small projects</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">FalconView
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">UI to control machines drived by linuxCNC</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_oldStuff_help.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Help System for small projects </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Lately I have been struggling with the help system. Unfortunately the help system of Qt did not work as expected. Or maybe I wasn't smart enough to use it ...</p>
<p>Anyway - I wanted to extend QHelpEngine, but then had to realize that the most important functions are not virtual - so no chance for customization.</p>
<p>I also didn't like that Qt's help system doesn't support images, so I decided to do it myself. I started with qdoc format, but then I had to hear that qdoc would be an internal tool. I was recommended doxygen. Only I didn't want to document my source code, but create a help system for end users.</p>
<p>For this doxygen is not the right tool. Much too complex and does a lot of things I don't want. Not even sure it can do what I want ...</p>
<p>I wanted a simple tool that doesn't require much time investment besides the actual writing. Ascidoc was under discussion, but the source code doesn't look very readable. Ended up with markdown. Some commands were already known from forums, the rest was quickly explored. The nice thing about markdown is that the source code still remains readable.</p>
<p>So I switched to markdown. Pretty soon I realized that the original didn't quite meet my needs. Fortunately, there is the GitHub extension. With that, I was able to get started.</p>
<p>My idea was that all files that become necessary in the help system should be included in the help file. So I looked for support for archives for Qt. Unfortunately Qt does not offer anything officially. Also, user requests for such support have been ignored for years. This is especially sad when you find out that the code has been available in Qt for years. Just marked as internal :(</p>
<p>I tried it anyway and am thrilled.</p>
<p>my directory structure looks like this: </p><div class="fragment"><div class="line">docs</div>
<div class="line">+---src</div>
<div class="line">| +---images</div>
<div class="line">+---html</div>
</div><!-- fragment --><p> In the directory <b>docs</b> is the <em>qhp</em> file, and auxiliary files for generating the help file.</p>
<p>In the directory <b>src</b> are the markdown files. Since my project is not that big, the localized and the original files are located there. For the sake of simplicity, I wrote in my language and only later created the English version. As it should turn out, this was the right way.</p>
<p>While researching markdown I stumbled across a hint to an editor that offers a live preview for markdown without the need to install a webserver or anything alike. The editor is called <b>Atom</b> and is in my opinion <b>indispensable</b> :) It unfortunately can't do an overwrite mode - which takes quite a bit of getting used to. Nevertheless it was a pure pleasure to write the help texts with it.</p>
<p><img src="src/images/Atom03.jpg" alt="Atom" class="inline"/></p>
<p>Why was it right to start writing in my language? As it turned out, neither qdoc nor markdown can handle the German special characters. Declaring the HTML file as utf-8 didn't help either.</p>
<p>So I wrote a filter that handles the HTML output of markdown. Later it turned out that Atom generates a &lt;br&gt; at every automatic line break, which looks very unattractive. So I extended the filter to remove all &lt;br&gt;.</p>
<p>Here is a taste of what the online help looks like now: <img src="src/images/FVHlp01.jpg" alt="Help" class="inline"/></p>
<p>Another reason why it was advantageous to start in my language: <b>deepl understands markdown.</b> Therefore I was able to translate all files via copy/paste and had already translated about 70%. The rework was quick and easy thanks to Atom.</p>
<p>Let's get to the source code.</p>
<p>I based the interface on <em>QHelpEngine</em> and analogously my <a class="el" href="classHelpEngine.html">HelpEngine</a> generates widgets for the tree of pages and for the list of keywords.</p>
<p>As a frame I chose QDockable, which shows the two widgets from <a class="el" href="classHelpEngine.html">HelpEngine</a> in a notebook on the left and an extension of the QTextBrowser on the right. Extension because the function <b>loadResource</b> has to be extended to load also links and images from the help file.</p>
<p>I liked the qhp file as used by Qt. It already contains (almost) everything necessary. Since I wanted to support multilingualism, I had to modify the file slightly. Here is my description file:</p>
<div class="fragment"><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</div>
<div class="line">&lt;QtHelpProject version=&quot;1.0&quot;&gt;</div>
<div class="line">    &lt;namespace&gt;de.schwarzrot.falconview.0.1&lt;/namespace&gt;</div>
<div class="line">    &lt;virtualFolder&gt;FalconView&lt;/virtualFolder&gt;</div>
<div class="line">    &lt;filterSection&gt;</div>
<div class="line">        &lt;filterAttribute&gt;FalconView&lt;/filterAttribute&gt;</div>
<div class="line">        &lt;filterAttribute&gt;0.1&lt;/filterAttribute&gt;</div>
<div class="line">        &lt;toc&gt;</div>
<div class="line">            &lt;section title=&quot;User Guide&quot; ref=&quot;index&quot;&gt;</div>
<div class="line">                &lt;section title=&quot;linuxCNC&quot; ref=&quot;integration&quot;/&gt;</div>
<div class="line">                &lt;section title=&quot;Center-Area&quot; ref=&quot;reference&quot;&gt;</div>
<div class="line">                    &lt;section title=&quot;NC-Editor&quot; ref=&quot;nceditor&quot;/&gt;</div>
<div class="line">                    &lt;section title=&quot;3D-Preview&quot; ref=&quot;preview&quot;/&gt;</div>
<div class="line">                    &lt;section title=&quot;JogView&quot; ref=&quot;jogview&quot;/&gt;</div>
<div class="line">                    &lt;section title=&quot;Settings&quot; ref=&quot;settingsnotebook&quot;&gt;</div>
<div class="line">                        &lt;section title=&quot;Fixtures&quot; ref=&quot;fixturemanager&quot;/&gt;</div>
<div class="line">                        &lt;section title=&quot;Preferences&quot; ref=&quot;preferences&quot;/&gt;</div>
<div class="line">                        &lt;section title=&quot;LC-Tools&quot; ref=&quot;lctooltable&quot;/&gt;</div>
<div class="line">                    &lt;/section&gt;</div>
<div class="line">                &lt;/section&gt;</div>
<div class="line">                &lt;section title=&quot;Toolbars&quot; ref=&quot;toolbars&quot;&gt;</div>
<div class="line">                    &lt;section title=&quot;ApplicationMode&quot; ref=&quot;tbappmode&quot;/&gt;</div>
<div class="line">                    &lt;section title=&quot;RunMode&quot; ref=&quot;tbrunmode&quot;/&gt;</div>
<div class="line">                    &lt;section title=&quot;Machine&quot; ref=&quot;tbmachine&quot;/&gt;</div>
<div class="line">                    &lt;section title=&quot;Extended&quot; ref=&quot;tbextend&quot;/&gt;</div>
<div class="line">                &lt;/section&gt;</div>
<div class="line">                &lt;section title=&quot;Status-Info&quot; ref=&quot;info&quot;&gt;</div>
<div class="line">                    &lt;section title=&quot;Position&quot; ref=&quot;sipos&quot;/&gt;</div>
<div class="line">                    &lt;section title=&quot;ToolInfo&quot; ref=&quot;sitool&quot;/&gt;</div>
<div class="line">                    &lt;section title=&quot;act.Codes&quot; ref=&quot;sicodes&quot;/&gt;</div>
<div class="line">                    &lt;section title=&quot;SpeedInfo&quot; ref=&quot;sispeed&quot;/&gt;</div>
<div class="line">                &lt;/section&gt;</div>
<div class="line">                &lt;section title=&quot;use case&quot; ref=&quot;usage&quot;/&gt;</div>
<div class="line">            &lt;/section&gt;</div>
<div class="line">        &lt;/toc&gt;</div>
<div class="line">        &lt;keywords&gt;</div>
<div class="line">            &lt;keyword name=&quot;3D Preview&quot; id=&quot;3D Preview&quot; ref=&quot;preview&quot;/&gt;</div>
<div class="line">            &lt;keyword name=&quot;FileManager&quot; id=&quot;fileManager&quot; ref=&quot;filemanager&quot;/&gt;</div>
<div class="line">            &lt;keyword name=&quot;FixtureManager&quot; id=&quot;FixtureManager&quot; ref=&quot;fixturemanager&quot;/&gt;</div>
<div class="line">            &lt;keyword name=&quot;JogView&quot; id=&quot;JogView&quot; ref=&quot;jogview&quot;/&gt;</div>
<div class="line">            &lt;keyword name=&quot;LCToolTable&quot; id=&quot;LCToolTable&quot; ref=&quot;lctooltable&quot;/&gt;</div>
<div class="line">            &lt;keyword name=&quot;MDIEditor&quot; id=&quot;MDIEditor&quot; ref=&quot;mdiedit&quot;/&gt;</div>
<div class="line">            &lt;keyword name=&quot;PathEditor&quot; id=&quot;PathEditor&quot; ref=&quot;nceditor&quot;/&gt;</div>
<div class="line">            &lt;keyword name=&quot;PreferencesEditor&quot; id=&quot;PreferencesEditor&quot; ref=&quot;preferences&quot;/&gt;</div>
<div class="line">            &lt;keyword name=&quot;SettingsNotebook&quot; id=&quot;SettingsNotebook&quot; ref=&quot;settingsnotebook&quot;/&gt;</div>
<div class="line">            &lt;keyword name=&quot;TestEdit&quot; id=&quot;TestEdit&quot; ref=&quot;nceditor&quot;/&gt;</div>
<div class="line">            &lt;keyword name=&quot;ToolEditor&quot; id=&quot;ToolEditor&quot; ref=&quot;tooleditor&quot;/&gt;</div>
<div class="line">            &lt;keyword name=&quot;ToolManager&quot; id=&quot;ToolManager&quot; ref=&quot;toolmanager&quot;/&gt;</div>
<div class="line">        &lt;/keywords&gt;</div>
<div class="line">        &lt;files&gt;</div>
<div class="line">            &lt;file&gt;*.html&lt;/file&gt;</div>
<div class="line">        &lt;/files&gt;</div>
<div class="line">    &lt;/filterSection&gt;</div>
<div class="line">&lt;/QtHelpProject&gt;</div>
</div><!-- fragment --><p>Namespace, virtualFolder and filterSection I took over unchanged, even if I don't use any of them. Only the <b>&lt;toc&gt;</b> and <b>&lt;keywords&gt;</b> sections are important to me. As you can see, I removed the file extension from the <b>ref</b> attributes. This way I can support multilingualism without the application having to load/know different help files.</p>
<p>The help usage in application is simple. In <em><a class="el" href="classMainWindow.html">MainWindow</a></em> the help widget is created: </p><div class="fragment"><div class="line">dlgHelp = new HelpDialog(this);</div>
</div><!-- fragment --><p> In the form for the <a class="el" href="classMainWindow.html">MainWindow</a> a menu entry for help is created, so in application code only the help function has to be connected to the menu entry:</p>
<div class="fragment"><div class="line">ui-&gt;actionHelp-&gt;setShortcut(QKeySequence::HelpContents);</div>
<div class="line">connect(ui-&gt;actionHelp, &amp;QAction::triggered, dlgHelp, &amp;HelpDialog::showHelp);</div>
</div><!-- fragment --><p> In my application, I want to display the appropriate help at each page change. For this I have captured the <em>objectName</em> of the pages as technical terms and translated them (manual extension of the *.ts file). Furthermore the technical terms are contained in the above *.qhp file as keywords. In the application I call the help then as follows: </p><div class="fragment"><div class="line">void DynCenterWidget::showEvent(QShowEvent* e) {</div>
<div class="line">  QWidget::showEvent(e);</div>
<div class="line">  if (e-&gt;type() == QEvent::Show) Core().help4Keyword(objectName());</div>
<div class="line">  }</div>
</div><!-- fragment --><p> As mentioned before, <b>loadResource</b> of QTextBrowser needs to be changed. Unfortunately, it turned out that QTextBrowser does not handle CSS styles that are stored in the meta area of a html-page. After some failed attempts I chose the variant where a DefaultStyleSheet is loaded in the browser. This led to the desired success: </p><div class="fragment"><div class="line">HelpBrowser::HelpBrowser(QWidget* parent)</div>
<div class="line"> : QTextBrowser(parent)</div>
<div class="line"> , engine(nullptr) {</div>
<div class="line">  document()-&gt;setDefaultStyleSheet(defaultStyles);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">const QString HelpBrowser::defaultStyles(&quot;table, th, td {&quot;</div>
<div class="line">                                           &quot;border-width: 1px;&quot;</div>
<div class="line">                                           &quot;border-color: #CCCCCC;&quot;</div>
<div class="line">                                           &quot;border-collapse: collapse;&quot;</div>
<div class="line">                                         &quot;}&quot;</div>
<div class="line">                                         &quot;img {vertical-align: middle; }&quot;</div>
<div class="line">                                         &quot;th, td {&quot;</div>
<div class="line">                                           &quot;padding: 15px;&quot;</div>
<div class="line">                                         &quot;}&quot;);</div>
</div><!-- fragment --><p> For the internal help classes I have split the tasks. <b><a class="el" href="classHelpEngine.html">HelpEngine</a></b> encapsulates the archive access, while the widget classes process the *.qhp file. The result of the processing is stored in the tree, respectively the list, on the one hand, and on the other hand a directory is created, which is transmitted to <b><a class="el" href="classHelpEngine.html">HelpEngine</a></b>, so that it can answer queries for keywords or pages and process them in a localized way.</p>
<p>Declaration: <a href="https://github.com/DjangoReinhard/FalconView/blob/main/src/util/helpengine.h">HelpEngine</a></p>
<p>Definition: <a href="https://github.com/DjangoReinhard/FalconView/blob/main/src/util/helpengine.cpp">HelpEngine</a></p>
<p>The help files are structured as follows:</p><ul>
<li>preview.md - english version</li>
<li>preview*_de*.md - localized version</li>
</ul>
<p><b><a class="el" href="classHelpEngine.html">HelpEngine</a></b> tries to load the localized version first. If this fails (e.g. because locale <em>es</em> is used instead of <em>de</em>), then the english standard is loaded.</p>
<p>Another problem (for me) was that I tried many different icons and images on the pages, but didn't want to have them all in the help file. So I had to figure out which images were actually used in the help files. All in all a bit too much to remember and type in each time. So I created a little helper script (<em>gfm</em> is the markdown interpreter with github extension, <em>fixhtml</em> is my filter for special characters):</p>
<div class="fragment"><div class="line">#!/bin/bash</div>
<div class="line">project=FalconView</div>
<div class="line">extIN=md</div>
<div class="line">extOut=html</div>
<div class="line"> </div>
<div class="line">for i in $(ls src/*.$extIN)</div>
<div class="line">do</div>
<div class="line">  t=html${i#src}</div>
<div class="line">  d=${t%.$extIN}.$extOut</div>
<div class="line">  cat $i | gfm | fixhtml -e htmlEntities.def &gt; $d</div>
<div class="line">done</div>
<div class="line">cd src</div>
<div class="line">images=`grep -Ro -P &quot;\&zwj;(images/(.*)\&zwj;)&quot; | sed &#39;s%.*(images/%%&#39; | sed &#39;s%)%%&#39;`</div>
<div class="line">cd ..</div>
<div class="line">cp ${project}.qhp html</div>
<div class="line">mkdir html/images 2&gt;/dev/null</div>
<div class="line">for i in $images</div>
<div class="line">do</div>
<div class="line">  echo $i</div>
<div class="line">  cp src/images/$i html/images</div>
<div class="line">done</div>
<div class="line">cd html</div>
<div class="line">zip -u9 ../FalconView.qzh *.html images/* FalconView.qhp</div>
<div class="line">cp -a ../FalconView.qzh .</div>
</div><!-- fragment --><p>For completeness - htmlEntites.def: </p><div class="fragment"><div class="line">ä &amp;auml;</div>
<div class="line">ö &amp;ouml;</div>
<div class="line">ü &amp;uuml;</div>
<div class="line">Ä &amp;Auml;</div>
<div class="line">Ö &amp;Ouml;</div>
<div class="line">Ü &amp;Uuml;</div>
<div class="line">ß &amp;szlig;</div>
<div class="line">&lt;br&gt;</div>
</div><!-- fragment --><p> ... and the code of the filter: </p><div class="fragment"><div class="line">#include &lt;QCoreApplication&gt;</div>
<div class="line">#include &lt;QTextStream&gt;</div>
<div class="line">#include &lt;QFile&gt;</div>
<div class="line">#include &lt;QDebug&gt;</div>
<div class="line">#include &lt;iostream&gt;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">static QString findFile(const QStringList&amp; args) {</div>
<div class="line">  int mx = args.size();</div>
<div class="line"> </div>
<div class="line">  for (int i=0; i &lt; mx; ++i) {</div>
<div class="line">      if (args.at(i) == &quot;-e&quot;) {</div>
<div class="line">         if ((i+1) &lt; mx) return args.at(i+1);</div>
<div class="line">         }</div>
<div class="line">      }</div>
<div class="line">  return QString();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">static int readEntities(const QString&amp; fileName, QMap&lt;QString, QString&gt;&amp; m) {</div>
<div class="line">  QFile file(fileName);</div>
<div class="line"> </div>
<div class="line">  if (!file.exists()) return 0;</div>
<div class="line">  if (!file.open(QIODevice::ReadOnly)) return 0;</div>
<div class="line">  QTextStream in(&amp;file);</div>
<div class="line">  QString     line = in.readLine();</div>
<div class="line">  QStringList parts;</div>
<div class="line">  QString     tok;</div>
<div class="line"> </div>
<div class="line">  while (!line.isNull()) {</div>
<div class="line">        parts = line.split(&quot; &quot;);</div>
<div class="line">        if (parts.size() &lt; 1) continue;</div>
<div class="line">        if (parts.size() &gt; 1) tok = parts[1];</div>
<div class="line">        else                  tok = QString();</div>
<div class="line">        m[parts[0]] = tok;</div>
<div class="line">        line = in.readLine();</div>
<div class="line">        }</div>
<div class="line">  file.close();</div>
<div class="line"> </div>
<div class="line">  return m.size();</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">static void processSource(QTextStream&amp; in, QMap&lt;QString, QString&gt;&amp; m) {</div>
<div class="line">  QString line = in.readLine();</div>
<div class="line"> </div>
<div class="line">  while (!line.isNull()) {</div>
<div class="line">        for (auto rp = m.constKeyValueBegin();</div>
<div class="line">             rp != m.constKeyValueEnd();</div>
<div class="line">             rp++) {</div>
<div class="line">            line.replace(rp-&gt;first, rp-&gt;second);</div>
<div class="line">            qDebug() &lt;&lt; &quot;cv: &quot; &lt;&lt; line;</div>
<div class="line">            }</div>
<div class="line">        std::cout &lt;&lt; line.toStdString().c_str() &lt;&lt; std::endl;</div>
<div class="line">        line = in.readLine();</div>
<div class="line">        }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">int main(int argc, char *argv[]) {</div>
<div class="line">  QCoreApplication a(argc, argv);</div>
<div class="line">  QMap&lt;QString, QString&gt; charMap;</div>
<div class="line">  QString fileName = findFile(QCoreApplication::arguments());</div>
<div class="line"> </div>
<div class="line">  if (readEntities(fileName, charMap)) {</div>
<div class="line">     QTextStream ts(stdin);</div>
<div class="line"> </div>
<div class="line">     processSource(ts, charMap);</div>
<div class="line">     return 0;</div>
<div class="line">     }</div>
<div class="line">  return -1;</div>
<div class="line">  }</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
